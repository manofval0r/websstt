<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout - Sidedish Foods</title>
    <meta name="google-signin-client_id"
        content="359742950645-bneg3ra0d7krpvfns2hngoor9rca96tv.apps.googleusercontent.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="checkout.css">

</head>

<body>
    <nav class="navbar">
        <div class="container">
            <div class="tagline"><img src="assets/header logo.png" alt="Sidedish Foods Logo">Sidedish Foods</div>
            <ul class="nav-links">
                <li><a href="index.htm">Home</a></li>
                <li><a href="menu.htm">Menu</a></li>
                <li><a href="about.htm">About</a></li>
                <li><a href="contact.htm">Help?</a></li>
                <!-- <li><a href="order-list.htm">Orders</a></li>
                <li><a href="admin-dashboard.htm">Admin</a></li> -->
            </ul>
            <div class="user-controls">
                <button id="login-btn" class="btn btn-text" onclick="openModal('login-modal')" style="display: flex">
                    <i class="fa-solid fa-user"></i>
                    <span>Sign In</span>
                </button>
                <div id="user-info" style="display: none">
                    <span id="user-name"></span>
                    <button class="btn btn-text" onclick="handleLogout()">
                        <i class="fa-solid fa-sign-out-alt"></i>
                    </button>
                </div>
                <a href="checkout.htm"><button id="cart-toggle" class="btn btn-text cart-badge" data-count="0"
                        title="Open cart">
                        <i class="fa-solid fa-cart-shopping"></i>
                        <span id="cart-count" class="sr-only">0</span>
                    </button></a>
            </div>
        </div>
    </nav>

    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Sign In to Continue</h3>
                <button class="close-modal" onclick="closeModal('login-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="login-form" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password:</label>
                        <input type="password" id="password" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Sign In</button>
                        <!-- Updated Google Button - GSI will render here -->
                        <div id="g_id_onload"
                            data-client_id="359742950645-bneg3ra0d7krpvfns2hngoor9rca96tv.apps.googleusercontent.com"
                            data-callback="handleGoogleCredentialResponse" data-auto_prompt="false">
                        </div>
                        <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"
                            data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="left"
                            data-width="300px"></div>
                    </div>
                    <!-- Removed the old button with onclick="signInWithGoogle()" as GSI handles it -->
            </div>
            <p class="switch-auth">
                Donâ€™t have an account? <a href="#" onclick="switchToSignup()">Sign Up</a>
            </p>
            </form>
        </div>
    </div>
    </div>

    <!-- Signup Modal -->
    <div id="signup-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create Your Account</h3>
                <button class="close-modal" onclick="closeModal('signup-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="signup-form" onsubmit="handleSignup(event)">
                    <div class="form-group">
                        <label for="name">Full Name:</label>
                        <input type="text" id="name" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-email">Email:</label>
                        <input type="email" id="signup-email" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password:</label>
                        <input type="password" id="signup-password" required>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirm Password:</label>
                        <input type="password" id="confirm-password" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Sign Up</button>
                        <!-- Updated Google Button - GSI will render here -->
                        <div class="g_id_signin" data-type="standard" data-size="large" data-theme="outline"
                            data-text="sign_up_with" data-shape="rectangular" data-logo_alignment="left"
                            data-width="300px">
                        </div>
                        <!-- Removed the old button with onclick="signUpWithGoogle()" as GSI handles it -->
                    </div>
                    <p class="switch-auth">
                        Already have an account? <a href="#" onclick="switchToLogin()">Sign In</a>
                    </p>
                </form>
            </div>
        </div>
    </div>
    <div class="section checkout-section">
        <div class="checkout-container">
            <!-- Order Summary Column -->
            <div class="checkout-summary">
                <div class="checkout-card">
                    <div class="checkout-card-header">
                        <h2>Order Summary</h2>
                        <span class="item-count" id="items-count"></span>
                    </div>
                    <div class="checkout-items" id="order-items">
                        <!-- Items will be inserted here by JS -->
                    </div>
                    <div class="checkout-totals">
                        <div class="totals-row">
                            <span>Subtotal</span>
                            <span id="order-total">0 NGN</span>
                        </div>
                        <div class="totals-row">
                            <span>Delivery Fee</span>
                            <span id="delivery-fee">--</span>
                        </div>
                        <div class="totals-divider"></div>
                        <div class="totals-row grand-total">
                            <span>Total</span>
                            <span id="grand-total">0 NGN</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Checkout Form Column -->
            <div class="checkout-form">
                <div class="checkout-card">
                    <div class="checkout-card-header">
                        <h2>Delivery Details</h2>
                    </div>
                    <div class="form-section">
                        <div class="form-group">
                            <label for="address">Delivery Address</label>
                            <input type="text" id="address" placeholder="Enter your full address" required
                                aria-label="Delivery address">
                            <p class="error-message" id="address-error" role="alert"></p>
                        </div>
                        <div class="form-group">
                            <label for="city">State</label>
                            <select id="city" onchange="updateDeliveryFee()" required aria-label="Select state"
                                class="select-styled">
                                <option value="">Select State</option>
                                <option value="Kano">Kano</option>
                                <option value="Abia">Abia</option>
                                <option value="Adamawa">Katsina</option>
                                <option value="Akwa Ibom">Jigawa</option>
                                <option value="Anambra">Bauchi</option>
                                <option value="Bauchi">Kaduna</option>
                                <!-- ... if they expand to other states ... -->
                            </select>
                            <p class="error-message" id="city-error" role="alert"></p>
                        </div>

                        <div class="form-group">
                            <label>Delivery Option</label>
                            <div class="radio-group">
                                <div class="radio-option">
                                    <input type="radio" name="delivery-option" id="delivery-option-delivery"
                                        value="delivery" checked onchange="updateDeliveryFee()">
                                    <label for="delivery-option-delivery">
                                        <i class="fa-solid fa-truck"></i>
                                        Home Delivery
                                    </label>
                                </div>
                                <div class="radio-option">
                                    <input type="radio" name="delivery-option" id="delivery-option-pickup"
                                        value="pickup" onchange="updateDeliveryFee()">
                                    <label for="delivery-option-pickup">
                                        <i class="fa-solid fa-store"></i>
                                        Restaurant Pickup
                                    </label>
                                </div>
                            </div>
                            <p class="info-message">*Orders under 10,000 NGN are only available for delivery in Kano.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="checkout-card">
                    <div class="checkout-card-header">
                        <h2>Payment Method</h2>
                    </div>
                    <div class="form-section">
                        <div class="payment-options">
                            <div class="payment-option">
                                <input type="radio" name="payment" id="bank-transfer" value="bank-transfer"
                                    onclick="showPaymentDetails('bank-transfer')">
                                <label for="bank-transfer">
                                    <i class="fa-solid fa-building-columns"></i>
                                    Bank Transfer
                                </label>
                            </div>
                            <div id="bank-transfer-details" class="payment-details">
                                <div class="bank-info">
                                    <div class="bank-info-row">
                                        <span>Account Name:</span>
                                        <strong>Aisha Ahmad Abdullahi</strong>
                                    </div>
                                    <div class="bank-info-row">
                                        <span>Account Number:</span>
                                        <strong>7019631217</strong>
                                    </div>
                                    <div class="bank-info-row">
                                        <span>Bank:</span>
                                        <strong>Opay</strong>
                                    </div>
                                </div>
                            </div>

                            <div class="payment-option">
                                <input type="radio" name="payment" id="cash-on-delivery" value="cash-on-delivery"
                                    onclick="showPaymentDetails('cash-on-delivery')">
                                <label for="cash-on-delivery">
                                    <i class="fa-solid fa-money-bill-wave"></i>
                                    Cash on Delivery
                                    <span class="tag">Kano only</span>
                                </label>
                            </div>

                            <div class="payment-option">
                                <input type="radio" name="payment" id="card-payment" value="card-payment"
                                    onclick="showPaymentDetails('card-payment')">
                                <label for="card-payment">
                                    <i class="fa-solid fa-credit-card"></i>
                                    Card Payment
                                    <span class="tag">Pickup only</span>
                                </label>
                            </div>
                        </div>
                        <p class="error-message" id="payment-error" role="alert"></p>
                    </div>
                </div>

                <button class="btn btn-primary place-order-btn" onclick="window.submitOrder()">
                    <i class="fa-solid fa-check"></i>
                    Place Order
                </button>
            </div>
        </div>
    </div>
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-left">
                <p>&copy; 2025 Sidedish Foods. All rights reserved.</p>
            </div>

            <div class="footer-center">
                <ul class="social-links">
                    <li>
                        <a href="https://instagram.com/sidedish_foods" target="_blank" aria-label="Instagram">
                            <i class="fab fa-instagram"></i> @sidedish_foods
                        </a>
                    </li>
                    <li>
                        <a href="" target="_blank" aria-label="TikTok">
                            <i class="fab fa-tiktok"></i> @sidedishfoods
                        </a>
                    </li>
                </ul>
            </div>

            <div class="footer-right">
                <p class="acknowledge-me">
                    <a href="https://david-idowu-portfolio.vercel.app/">By Valor | AI Full-Stack</a>
                </p>
            </div>
        </div>
    </footer>
    <script>
        window.deliveryFee = 0;

        window.addEventListener('load', function () {
            if (typeof updateCartSummary === 'function') {
                updateCartSummary();
            }
            if (typeof updateDeliveryFee === 'function') {
                updateDeliveryFee();
            }
        });
    </script>
    <script src="script.js"></script>
    <script>
        // Inline JavaScript code that depends on BASE_URL
        window.addEventListener('load', function () {
            try {
                updateCheckoutSummary();
                updateDeliveryFee();
            } catch (error) {
                console.error('Error during window.onload:', error);
            }
        });
        function updateCheckoutSummary() {
            console.log('Updating checkout summary...');
            const orderItemsContainer = document.getElementById('order-items');
            const orderTotalElement = document.getElementById('order-total');

            if (!cart.length) {
                orderItemsContainer.innerHTML = '<p>Your cart is empty.</p>';
                orderTotalElement.textContent = '0';
                return;
            }

            let html = '';
            cart.forEach((item, idx) => {
                html += `
                    <div class="checkout-item">
                        <img src="${item.img || 'assets/no-pic.jpg'}" alt="${item.name}" style="width:64px;height:64px;object-fit:cover;border-radius:6px;margin-right:10px;">
                        <strong>${item.name}</strong>
                        <div>${(item.price).toLocaleString('en-NG')} NGN x ${item.qty}</div>
                        <button class="btn btn-text" onclick="removeFromCart(${idx})" aria-label="Remove item">Remove</button>
                    </div>
                `;
            });

            orderItemsContainer.innerHTML = html;
            orderTotalElement.textContent = total.toLocaleString('en-NG');
        }
    </script>
</body>

</html>